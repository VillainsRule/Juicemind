const JOIN_NAME = 'get trolled lol';

import { initializeApp } from 'firebase/app';

const app = initializeApp({
    apiKey: 'AIzaSyBQxN5hUH9HCpvmFZ7rmeYPMprdle_3GsQ',
    authDomain: 'play.juicemind.com',
    projectId: 'juicemind-a9d9e',
    storageBucket: 'juicemind-a9d9e.appspot.com',
    messagingSenderId: '1043717487308',
    appId: '1:1043717487308:web:60faa200f20f45cfa0e069',
    measurementId: 'G-FGRLNTRZ5L',
    databaseURL: 'https://juicemind-a9d9e-default-rtdb.firebaseio.com'
});

import { getDatabase, ref, query, orderByChild, startAt, onChildAdded } from 'firebase/database';

const db = getDatabase(app);
const gameRoomsRef = ref(db, 'gameRooms');
const now = Date.now();

const newRoomsQuery = query(gameRoomsRef, orderByChild('createdAt'), startAt(now));

onChildAdded(newRoomsQuery, (snapshot) => {
    const roomData = snapshot.val();
    const roomId = snapshot.key;

    console.log('new game room:', roomId, roomData.pin);

    fetch('https://us-central1-juicemind-a9d9e.cloudfunctions.net/joinQuiz', {
        headers: {
            'content-type': 'application/json'
        },
        body: JSON.stringify({
            data: {
                userId: Math.random().toString().slice(2),
                gameRoomId: roomId,
                nickname: JOIN_NAME
            }
        }),
        method: 'POST'
    }).then(r => r.json()).then(r => console.log(r));
});

console.log('listening for rooms');
